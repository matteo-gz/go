
### 关键字 make vs new

> [src/builtin/builtin.go](https://github.com/matteo-gz/go/blob/note/1.19/src/builtin/builtin.go)

#### make 

`func make(t Type, size ...IntegerType) Type`


make 内置函数可以用来分配和初始化 slice、map 或 channel 对象。
和 new 函数类似，make 函数的第一个参数是类型而不是值。
不同于 new 函数，make 函数返回的类型和其参数的类型相同，而不是其指针类型。其结果的规格取决于参数的类型：

Slice：第一个参数指定了 slice 的长度，它的容量与长度相同。第二个参数可以指定一个不小于长度的不同容量；如果没有提供，容量将与长度相同。例如，make([]int, 0, 10) 将分配一个大小为 10 的基础数组，并返回长度为 0、容量为 10 的 slice，它支持该基础数组。

Map：分配了一个空 map，并为其分配了足够的空间以容纳指定数量的元素。可以省略第一个参数，这样将分配一个较小的初始大小。

Channel：初始化具有指定缓冲区容量的通道。如果容量为零或省略，通道将是无缓冲区的。

简而言之，make 函数是 Go 语言中用于创建和初始化 slice、map 或 channel 的内置函数，其参数和返回值类型与其参数的类型相同，而不是其指针类型。

#### new

`func new(Type) *Type`

new 内置函数用于分配内存空间，它的第一个参数是一个类型而不是值，返回的值是指向新分配的该类型零值的指针。

具体来说，new 函数会根据参数指定的类型分配一块内存空间，并将其初始化为该类型的零值，然后返回一个指向该内存空间的指针。这个指针指向的是分配的内存空间的首地址。

需要注意的是，new 函数只分配了内存空间，并没有对其进行初始化。如果需要对内存空间进行初始化，可以使用 make 函数来创建和初始化某些引用类型的值，例如切片、映射和通道等。

简而言之，new 函数是 Go 语言中用于分配指定类型零值所在内存空间并返回其指针的内置函数。

#### 区别

在 Go 语言中，new 和 make 都是内置函数，但它们用于分配内存的方式和对象类型是不同的。

new 函数用于分配一块内存，返回的是该类型的指针。new 函数的语法如下：

```go
ptr := new(T)
```

其中，T 表示要分配的类型，ptr 是一个指向新分配的零值 T 的指针。

需要注意的是，new 函数只分配内存，并未对该内存进行初始化，因此返回的指针指向的是该类型的零值。

make 函数用于分配并初始化某些引用类型的值，例如切片、映射和通道等。make 函数的语法如下：

```go
v := make(T, args...)
```

其中，T 表示要创建和初始化的类型，args... 表示可选的参数，用于指定要创建的对象的长度或容量等信息。

make 函数返回的是该类型的值，而不是指针。需要注意的是，make 函数会初始化对象的各个字段，因此返回的值是指向已初始化的对象的引用。

简而言之，new 函数用于分配内存，返回的是指向该类型零值的指针；而 make 函数用于分配并初始化某些引用类型的值，返回的是已初始化的对象的引用。在实际使用中，需要根据具体情况选择 new 或 make 函数。